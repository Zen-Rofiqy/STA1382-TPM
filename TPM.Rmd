---
title: "TPM"
author: "Angga Fathan Rofiqy"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  rmdformats::downcute:
    self_contained: true
    thumbnails: false
    lightbox: true
    gallery: true
    highlight: tango
    code_folding: show
    toc_depth: 3
    number_sections: false
    toc_float:
      collapsed: true
      smooth_scroll: true
    fig_caption: true
pkgdown:
  as_is: true
---

```{r message=FALSE, warning=FALSE, include=FALSE}
#                      -=( Install & Load Package Function )=-
install_load <- function (package1, ...)  {   

   # convert arguments to vector
   packages <- c(package1, ...)

   # start loop to determine if each package is installed
   for(package in packages){

       # if package is installed locally, load
       if(package %in% rownames(installed.packages()))
          do.call('library', list(package))

       # if package is not installed locally, download, then load
       else {
          install.packages(package)
          do.call("library", list(package))
       }
   } 
}

install_load("DT","dplyr","ggplot2","gridExtra","MASS","tree")

theme1.1 <- list(
  geom_hline(yintercept = 0, size = 1, colour="#333333"),
  theme(axis.text.x = element_text(angle = 45, hjust = 1, 
                                   margin = margin(b = 10, t=-20)),
        axis.text.y = element_text(vjust = 0.5, face = "bold", 
                                   margin = margin(l = 20, r = 0)),
        plot.title = element_text(hjust = 0.5, face = "bold"),
        text = element_text(size = 30),
        plot.subtitle = element_text(hjust = 0.5),
        panel.background = element_rect(fill = 'transparent'),
        plot.background = element_rect(fill='transparent', color=NA),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
        ) 
)
```

```{r setup, include=FALSE, echo=FALSE, warning=FALSE, message = FALSE}
require("knitr")
opts_knit$set(root.dir = "C:/Users/Fathan/Documents/Obsidian Vault/2. Kuliah/Smt 6/2. Teknik Pembelajaran Mesin/Project")

#Export chart
export.chart <- "C:/Users/Fathan/Documents/Obsidian Vault/2. Kuliah/Smt 6/2. Teknik Pembelajaran Mesin/Project/Chart"
```

> <mark style="background-color: #91CCDB">**Code/Syntax :** [File.rmd](https://github.com/Zen-Rofiqy/STA1382-TPM/blob/main/TMP.Rmd) </mark>

# Pertemuan 1

> **Penyiapan Data (R)**

## 1. **Statistik Deskriptif**

**Daftar variabel :**

-   `Pregnancies` : Number of times pregnant

-   `Glucose` : Plasma glucose concentration a 2 hours in an oral glucose tolerance test

-   `BloodPressure` : Diastolic blood pressure (mm Hg)

-   `SkinThickness` : Triceps skin fold thickness (mm)

-   `Insulin` : 2-Hour serum insulin (mu U/ml)

-   `BMI` : Body mass index (weight in kg/(height in m)\^2)

-   `DiabetesPedigreeFunction` : Diabetes pedigree function

-   `Age` : Age (years)

-   `Outcome` : Class variable (0 or 1) 268 of 768 are 1 (diabetes), the others are 0 (tidak diabetes)

```{r}

data <- read.csv('/kaggle/input/pima-indians-diabetes-database/diabetes.csv')
summary(data)
head(data, 10)
```

```{r}
library(httr)

# Gantilah 'your_username' dan 'your_authkey' dengan informasi akun Kaggle Anda
username <- "zenrofiqy"
authkey <- "594416325ca5f1711fb40cb5e1795b8c"

url <- "https://www.kaggle.com/datasets/uciml/pima-indians-diabetes-database/download?datasetVersionNumber=1"



# Lakukan permintaan GET dengan autentikasi
dataset <- httr::GET(url, httr::authenticate(username, authkey, type = "basic"))

# Simpan file CSV ke tempat sementara
temp <- tempfile(fileext = ".csv")
writeBin(dataset$content, temp)

# Baca data CSV langsung
data <- read.csv(temp)

# Hapus file sementara
file.remove(temp)

View(data)

```

# Pertemuan 3

```{r}
str(cpus)
cpus.ltr <- tree(log10(perf) ~ syct + mmin + mmax + chmin + chmax, data=cpus)
plot(cpus.ltr)
text(cpus.ltr)

summary(cpus.ltr)
```

# Pertemuan 4

Entropy

```{r}
p <- 0.6919
E <- function(p) -p * log2(p) - (1-p) * log2(1-p)
E(p)
E(p)
```

Information Gain

```{r}
IG <- 
```

```{r}
info_gain <- function(D, A) {
  H_D <- H(D[[A]]) 
  
  values <- unique(D[[A]])
  D_v <- split(D, D[[A]]) 
  
  H_D_A <- sum(sapply(D_v, function(x) length(x)/nrow(D) * H(x[[A]]))) 
  
  return(H_D - H_D_A)
}

H <- function(D) {
  p <- table(D)/length(D) 
  return(sum(-p*log2(p))) 
}



# Data 
data <- data.frame(
  outcome = c("Yes","Yes","No","Yes","No","Yes"),
  attribute = c("Tall","Tall","Tall","Short","Short","Short")
)

# Hitung entropy sebelum split
H_D <- H(data$outcome) 
H_D

# Split data berdasarkan attribute
D_v <- split(data, data$attribute)

# Hitung weighted entropy setelah split
H_D_A <- sum(sapply(D_v, function(x) length(x)/nrow(data) * H(x$outcome)))
H_D_A

# Hitung information gain
info_gain(data, "attribute")
```

```{r}
# Tabel kontingensi  
table <- matrix(c(6,3,2,1), nrow = 2, byrow = TRUE)
table

# Hitung total data 
N <- sum(table)  

# Hitung entropy sebelum split
H_D <- sum(-table/N * log2(table/N))

# Buat tabel kontingensi terpisah untuk setiap atribut
table_A1 <- matrix(c(6,2), nrow = 1)
table_A2 <- matrix(c(3,1), nrow = 1)

# Hitung weighted entropy
H_A <- sum(table[,1]/N * apply(cbind(table_A1, table_A2), 1, function(x) sum(-x/sum(x)*log2(x/sum(x))))) 

# Hitung information gain
IG <- H_D - H_A
IG
```

```{r}
# Tabel kontingensi  
table <- matrix(c(561, 27,
                  51.75, 2.49,
                  95.41, 4.59,
                  74.8, 8.08,
                  189, 307), nrow = 2, byrow = TRUE)
table

# Hitung total data 
N <- sum(table)  

# Hitung entropy sebelum split
H_D <- sum(-table/N * log2(table/N))

# Buat tabel kontingensi terpisah untuk setiap atribut
table_A1 <- matrix(c(6,2), nrow = 1)
table_A2 <- matrix(c(3,1), nrow = 1)

# Hitung weighted entropy
H_A <- sum(table[,1]/N * apply(cbind(table_A1, table_A2), 1, function(x) sum(-x/sum(x)*log2(x/sum(x))))) 

# Hitung information gain
IG <- H_D - H_A
IG
```

Ilustrasi

```{r}
##Classification Tree
propensity <- read.csv("D:/datatree01.csv", sep=";", header=TRUE)
tertarik <- factor(propensity$Tertarik.Beli., levels = 0:1, labels = c("Tidak", "Tertarik")) 
jk <- factor(propensity$Jenis.Kelamin,   levels = 0:1, labels = c("Perempuan", "Laki-Laki")) 
kota <- factor(propensity$Tinggal.di.Kota, levels = 0:1, labels = c("Tidak", "Ya"))
single <- factor(propensity$Single, levels = 0:1, labels = c("Menikah", "Single")) 
merokok <- factor(propensity$Perokok, levels = 0:1, labels = c("Tidak", "Ya")) 
budget <- propensity$Budget
usia <-propensity$usia
```

```{r}
library(rpart)
model.01 <- rpart(tertarik ~ jk + kota + single + usia + merokok + budget,
method="class", control = rpart.control(minsplit = 100))
model.01
```

```{r}
library(rpart.plot)
rpart.plot(model.01, extra=6)
```

```{r}
rpart.plot(model.01, extra=1)
```

```{r}
model.02 <- rpart(tertarik ~ jk + kota + single + usia + merokok + budget,
method="class", control = rpart.control(minsplit = 50))
rpart.plot(model.02, extra=6)
```

```{r}
data.training <- data.frame(jk, kota, single, usia, merokok, budget, tertarik) 
prob.prediksi.02 <- predict(model.02, newdata=data.training)
head(prob.prediksi.02)
```

```{r}
prediksi.02 <- factor(ifelse(prob.prediksi.02[,2] > 0.5, 1, 0),
levels = 0:1, labels = c("Tidak", "Te r t a r i k "))


library(caret)
confusionMatrix(prediksi.02, tertarik)
```

```{r}
prediksi.02 <- factor(ifelse(prob.prediksi.02[,2] > 0.6, 1, 0),
levels = 0:1, labels = c("Tidak", "Te r t a r i k "))

confusionMatrix(prediksi.02, tertarik)
```

```{r}
prediksi.02 <- factor(ifelse(prob.prediksi.02[,2] > 0.3, 1, 0),
levels = 0:1, labels = c("Tidak", "Te r t a r i k "))

confusionMatrix(prediksi.02, tertarik)
```

# Pertemuan 5

## Syntax Kuliah {.tabset}

### **Binary classification**

```{r}
library(neuralnet)
nn <- neuralnet(Species=="setosa" ~Petal.Length  +Petal.Width, iris, 
                linear.output = FALSE)
print(nn) 
plot(nn)
```

### **Multiclass classification**

```{r}
nn2 <- neuralnet(Species ~ Petal.Length + Petal.Width, iris, linear.output = FALSE) 
names(nn2)
nn2$act.fct 
print(nn2)
plot(nn2)
```

### **Custom activation function**

```{r}
softplus <- function(x) log(1 + exp(x))
nn3  <-  neuralnet((Species  ==  "setosa")  ~  Petal.Length  +  Petal.Width,  iris, 
linear.output = FALSE, hidden = c(3, 2), act.fct = softplus)
print(nn3) 
plot(nn3)
```

## Tugas

```{r}
f.act <- function(x) log(1 + exp(x))

neuron <- function(x1, x2, x3){
  h1 = .5*x1 - .2*x2 - .1*x3
  h1 = f.act(h1)
  
  h2 = .3*x1 + .1*x2 + .6*x3
  h2 = f.act(h2)
  
  out = .2*h1 - .1*h2 
  out = f.act(out)
  return(out)
}

r1 <- neuron(1, 1, 2)
r2 <- neuron(2, 3, 1)
r3 <- neuron(2, 1, 1) 

y <- c(2, 3, 1)

y_ <- data.frame(r1, r2, r3)
print(y_)

n <- 3
mse <- 1/n * sum((y - y_)^2)
print(mse)
```

## Praktikum 5

### Libarary

```{r}
#install.packages("tensorflow")
#install.packages("keras")

#library("reticulate")
#virtualenv_create("r-reticulate2", python = install_python())
#tensorflow::install_tensorflow()
#keras::install_keras()

# Delete Installation
#wunlink("~/.virtualenvs/r-tensorflow", recursive = TRUE)
```

### Model Klasifikasi NN

```{r}

```
